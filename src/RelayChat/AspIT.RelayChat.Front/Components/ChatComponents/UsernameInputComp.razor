@using AspIT.RelayChat.Entities
@using AspIT.RelayChat.SignalRLibrary
@using System.Diagnostics
@inject UsernameState UsernameState
@inject Chat chat

<div>
    @if (!isUsernameSet)
    {
        <div>
            <label for="username">Username:</label>
            <InputText id="username" @bind-Value="userModel.Username" disabled="@isUsernameSet" />
        </div>
        <button @onclick=HandleSubmit>Submit</button>
        <!--
        <EditForm Model="userModel" OnValidSubmit="HandleSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary />

        </EditForm>
        -->
    }
    else
    {
        <p>Welcome, @userModel.Username!</p>
    }
</div>

@code {
    private User userModel = new();
    private bool isUsernameSet = false;
    public string test;

    private async Task HandleSubmit()
    {
        Debug.WriteLine("HandleSubmit");
        isUsernameSet = true;
        UsernameState.SetUsername(userModel.Username);
        await chat.Start();
        await InvokeAsync(StateHasChanged);
    }
}
